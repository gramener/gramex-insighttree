<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

## insightTree

Renders a hierarchical tree based on the provided data and configuration.

This function calculates a tree data structure based on the input data and configuration,
then renders the tree into the specified DOM element. It also provides interactivity
to expand or collapse nodes upon user clicks.

### Parameters

- `selector` **[string][1]** The CSS selector of the DOM element where the tree will be rendered.
- `options` **[Object][2]** Configuration for the tree rendering and interaction.

  - `options.data` **[Array][3]<[Object][2]>** An array of objects representing the data rows.
  - `options.groups` **([Array][3]<[string][1]> | [Object][2])** Defines the hierarchy levels of the tree.
  - `options.metrics` **([Array][3]<[string][1]> | [Object][2])** Specifies the metrics to aggregate.
  - `options.sort` **([string][1] | [Object][2])?** Defines the sorting criteria for each level.
  - `options.impact` **([string][1] | [function][4])?** Specifies the impact metric to rank insights by.
  - `options.totalGroup` **[string][1]** Name of the total row's `GROUP`. (optional, default `"Total"`)
  - `options.render` **[function][4]** A function to render the tree. (optional, default `tableRender`)
  - `options.rankBy` &#x20;

### Examples

```javascript
const tree = insightTree("#myTree", {
  data: [...],
  groups: ["a", "b"],
  metrics: ["x", "y"],
  sort: "+x",
  impact: "x"
});
```

- Throws **[Error][5]** Throws an error if the provided selector does not match any DOM element.

Returns **[Object][2]** Returns an object with methods to interact with the rendered tree.

Returns **[Array][3]<[Object][2]>** .tree - The calculated tree data structure.

Returns **[function][4]** .update - Method to update the tree.

Returns **[function][4]** .toggle - Method to toggle nodes' expansion or collapse state.

Returns **[function][4]** .show - Method to show/hide nodes based on a rule.

Returns **[function][4]** .classed - Method to set class on each node

## toggle

Toggles the expansion or collapse state of the specified node.

If `force` is not provided, toggles the node.
`force=true` expands the node.
`force=false` collapses the node.

Uses `data-insight-level` to determine levels.
After toggling, it also toggles the visibility of all child nodes.
Direct children are shown/hidden based when the node is expanded/collapsed.
Grandchildren and below are always hidden.

### Parameters

- `insightTree` **[Object][2]** insightTree object
- `node` **[HTMLElement][6]** The DOM node to be toggled.
- `force` **[boolean][7]??** `true` expands node. `false` collapses node. If skipped, toggles node.

### Examples

```javascript
// Toggle the root node
toggle(treeData, document.querySelector("[data-insight-level=0]"));
// Expand the root node
toggle(treeData, document.querySelector("[data-insight-level=0]"), true);
// Collapse the root node
toggle(treeData, document.querySelector("[data-insight-level=0]"), false);
```

Returns **[insightTree][8]** Returns the insightTree object.

## show

Filters the tree nodes based on a specified rule, expanding or collapsing each node accordingly.

Uses `data-insight-level` to determine levels.
Applies the filter function to each node and expands the row if it returns `true`, else collapses it.
The filter function receives two parameters:

- `row`: The node object with properties like `LEVEL`, `RANK`, `GROUP`, and all group keys for the row.
- `node`: The DOM node corresponding to the row.

### Parameters

- `insightTree` **[Object][2]** insightTree object
- `filter` **function ([Object][2], [HTMLElement][6]): [boolean][7]** function(row, node) that returns true/false to expand/collapse node
- `options` **[Object][2]?** display options (optional, default `{}`)

  - `options.openAncestors` **[boolean][7]** If true, opens all ancestors of the shown nodes. (optional, default `true`)
  - `options.showSiblings` **[boolean][7]** If true, shows all siblings of the shown nodes. (optional, default `false`)
  - `options.hiddenClass` **[string][1]** The CSS class to apply to hidden nodes. (optional, default `"insight-hidden"`)
  - `options.closedClass` **[string][1]** The CSS class to apply to closed nodes. (optional, default `"insight-closed"`)

### Examples

```javascript
// Assuming the DOM has nodes with `data-insight-level` attribute and a corresponding tree data structure.
show(treeData, (row) => row[LEVEL] == 0 || row[GROUP] == "Bonn");
```

Returns **[insightTree][8]** Returns the insightTree object.

## update

Updates the visibility and styling of tree nodes based on the specified rank and level criteria.

Uses `data-insight-level` and `data-insight-rank` of the nodes to determine levels and ranks.

- Nodes with a rank == options.rank will have ".insight-current".
- Nodes with a rank <= options.rank will have ".insight-highlight".
- Nodes will be shown if their rank <= options.rank, or level <= options.level,
  or they have a child node that meets the rank criteria.
- Closed nodes (without a child that meets the rank criteria) will have ".insight-closed".

### Parameters

- `insightTree` **[Object][2]** insightTree object
- `$1` **[Object][2]**&#x20;

  - `$1.rank` &#x20;
  - `$1.level` &#x20;

- `showOptions` (optional, default `{}`)
- `options` **[Object][2]** The criteria for updating the tree nodes.

  - `options.rank` **[number][9]?** The rank criteria. Nodes with rank <= options.rank will be highlighted.
  - `options.level` **[number][9]?** The level criteria. Nodes with level <= options.value will be shown.
  - `options.showOptions` **[Object][2]?** Options for insightTree.show().

### Examples

```javascript
// Assuming the DOM has nodes with `data-insight-level` and `data-insight-rank` attributes.
update(treeData, { rank: 3, level: 2 }, { showSiblings: true });
```

Returns **[insightTree][8]** Returns the insightTree object.

## subtotal

Calculates a hierarchical tree structure based on the provided data and configuration.

### Parameters

- `options` **[Object][2]** Configuration for the tree calculation.

  - `options.data` **[Array][3]<[Object][2]>** An array of objects representing the data rows.
  - `options.groups` **([Array][3]<[string][1]> | [Object][2])** \['col', ...] or {col: row => ...} defines the hierarchy levels of the tree.
  - `options.metrics` **([Array][3]<[string][1]> | [Object][2])** \['col', ...] or {col: 'sum', col: d => ...} specifies the metrics to aggregate.
  - `options.sort` **([string][1] | [Object][2])?** '+col', '-col', or {col1: '-col2', ...} defines the sorting criteria for each level.
  - `options.impact` **([string][1] | [function][4])?** '+col', '-col', or d => ... specifies the impact metric to rank insights by. (optional, default `undefined`)
  - `options.rankBy` **([string][1] | [function][4])?** '+col', '-col', or d => ... specifies the metric to traverse insights by. (optional, default `v=>v[IMPACT]*v[SURPRISE]`)
  - `options.totalGroup` **[string][1]** Name of the total row's `GROUP`. (optional, default `"Total"`)

<!---->

- Throws **[Error][5]** Throws an error for invalid `groups`, `metrics`, `sort`, or `impact` configurations.

Returns **[Array][3]<[Object][2]>** Returns an array of objects representing the calculated tree structure.

## flatten

Flattens a tree structure into an array, while applying sorting rules to each level.

### Parameters

- `tree` **[Object][2]** The tree structure to flatten.
- `sorts` **[Array][3]<[Function][4]>** An array of sorting functions to apply at each level of the tree.

Returns **[Array][3]** The flattened array.

[1]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String
[2]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object
[3]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array
[4]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function
[5]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error
[6]: https://developer.mozilla.org/docs/Web/HTML/Element
[7]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean
[8]: #insighttree
[9]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number
