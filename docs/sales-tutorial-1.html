<meta charset="utf-8">
<link rel="stylesheet" href="../insighttree.css">
<div class="sales-tree"></div>

<script type="module">
  import { csvParse } from "https://cdn.skypack.dev/d3-dsv@3";
  const response = await fetch("../app/sales-data.csv");
  const data = csvParse(await response.text())

  import { insightTree } from "../index.js";

  const tree = insightTree({
    selector: ".sales-tree",
    data: data,
    // Group the data by city, then product, then channel
    groups: ["city", "product", "channel"],
    // Calculate the total of sales and target
    metrics: ["sales", "target"],
    // Rank insights by where the sales missed the target the most
    rankBy: ({ sales, target }) => sales - target,
  });
  // Show top 4 insights
  tree.update({ rank: 4 })
</script>
